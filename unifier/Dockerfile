from nginx:1.11.10-alpine
ARG ARCHSTOR_INTERNAL_PORT
ARG QREMIS_API_INTERNAL_PORT
ARG ACC_IDNEST_INTERNAL_PORT
ARG DEAD_SIMPLE_INTERFACE_INTERNAL_PORT
ARG REC_API_INTERNAL_PORT
ARG LISTEN="8080"
ARG REFRESH="10s"
ARG TIMEOUT="30"
ARG MAX_FSIZE="20m"
ENV LISTEN=$LISTEN
ENV REFRESH=$REFRESH
ENV TIMEOUT=$TIMEOUT
ENV MAX_FSIZE=$MAX_FSIZE
ENV ARCHSTOR_INTERNAL_PORT=$ARCHSTOR_INTERNAL_PORT
ENV QREMIS_API_INTERNAL_PORT=$QREMIS_API_INTERNAL_PORT
ENV ACC_IDNEST_INTERNAL_PORT=$ACC_IDNEST_INTERNAL_PORT
ENV DEAD_SIMPLE_INTERFACE_INTERNAL_PORT=$DEAD_SIMPLE_INTERFACE_INTERNAL_PORT
ENV REC_API_INTERNAL_PORT=$REC_API_INTERNAL_PORT

RUN rm /etc/nginx/conf.d/*
COPY proxy.template /etc/nginx/conf.d/
RUN envsubst '$$REC_API_INTERNAL_PORT $$DEAD_SIMPLE_INTERFACE_INTERNAL_PORT $$ARCHSTOR_INTERNAL_PORT $$QREMIS_API_INTERNAL_PORT $$ACC_IDNEST_INTERNAL_PORT $$LISTEN $$REFRESH $$TIMEOUT $$MAX_FSIZE' < /etc/nginx/conf.d/proxy.template > /etc/nginx/conf.d/proxy.conf
